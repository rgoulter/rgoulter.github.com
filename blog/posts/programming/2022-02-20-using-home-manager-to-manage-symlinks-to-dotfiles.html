<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Using Home Manager to Manage Symlinks to Dotfiles - Richard Goulter's Blog</title>

        <!-- My (Old) CSS theme -->
        <link rel="stylesheet" type="text/css" href="../../../css/default.css" />

        <!--
            jQuery & jQueryUI
        -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script src="https://code.jquery.com/ui/1.11.3/jquery-ui.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css" />

        <!--
            Pandoc Style CSS
            (for syntax highlighted snippets)
        -->
        <link rel="stylesheet" type="text/css" href="../../../css/syntax.css" />

        <!--
            Bootstrap
        -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

        <style>
            /*
             * Bootstrap defines blockquote as 17px,
             * so it looks stupidly large in my blogposts. */
            blockquote {
                font-size: 14px;
            }
        </style>

        <!--
            Waypoints, and Waypoints-Sticky,
            so we can do this:
            http://imakewebthings.com/waypoints/shortcuts/sticky-elements/
        -->
        <script src="../../../js/jquery.waypoints.min.js"></script>
        <script src="../../../js/sticky.min.js"></script>

        <!-- My analytics stuff -->
        <script src="../../../js/my_analytics.js"></script>
        <script src="../../../js/my_analytics_debug.js"></script>

        <!--
            TOCify
        -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>

        <!--
            Patched TOCify css file.
            (Don't want fixed `.tocify`).
        -->
        <link rel="stylesheet" type="text/css" href="../../../css/jquery.tocify.css" />

        <style>
        .navbar {
            margin-bottom: 0px;
        }

        .banner-image {
            width:100%;
        }

        .banner {
            margin-left: 0px;
            margin-right: 0px;
        }

        body {
            background-color: #e2e2e2;
        }

        #page {
            padding-left:0;
            padding-right:0;
            background-color: #ffffff;
        }
        </style>

        <!-- Google Analytics -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-H13NWYDX0G"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-H13NWYDX0G');
        </script>
    </head>
    <body>
        <div id="page" class="container">
            <!-- This, with no padding on left/right -->
            <div class="banner">
                <nav class="navbar navbar-default">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>

            <!-- The Hamburger -->
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../">Richard Goulter's Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
            <li><a href="../../../">Home</a></li>
            <li><a href="../../../blog/yi.html">Yi</a></li>
            <li><a href="../../../blog/emacs.html">Emacs</a></li>
            <li><a href="../../../blog/what-i-wish-i-knew-when-i-started-using-nix.html">Nixpkgs</a></li>
            <li><a href="../../../blog/archive.html">Archive</a></li>
        </ul>
    </div>
</nav>

            </div>

            <hr style="margin: 0px; border-top: 5px solid black;" />

            <div id="content" class="container">
                <h1>Using Home Manager to Manage Symlinks to Dotfiles</h1>
                <div class="info">
    Posted on February 20, 2022
    
        by Richard Goulter
    <br />
    
    Tags: <a title="All pages tagged 'programming.nix'." href="../../../blog/tags/programming.nix.html" rel="tag">programming.nix</a>, <a title="All pages tagged 'programming.dotfiles'." href="../../../blog/tags/programming.dotfiles.html" rel="tag">programming.dotfiles</a>
    
</div>

<p><a href="https://github.com/anishathalye/dotbot">dotbot</a> is a popular way of managing
symlinks to dotfiles, and I used it for some time.</p>
<p>I’ve gradually been becoming more comfortable with <a href="https://nixos.org/">Nix</a>.</p>
<p>Nix remains relatively niche, so: Nix allows programmatic management of packages
installed to a computer. Nix refers to the expression language that describes
these packages, the tool which evaluates these expressions. It’s also pretty
closely tied to Nixpkgs (a large repository of packages), and NixOS (a Linux
distribution which is configured using Nix expressions).</p>
<p>Nix tooling is friendly towards words like “declarative” and “X-as-Code”.</p>
<p><a href="https://github.com/nix-community/home-manager">Home Manager</a> is a popular tool
which uses Nix configurations to manage a user’s environment, in a similar
manner to how NixOS’s system is configured from a Nix file.<br />
It complements NixOS, but I’ve been happy to use NixOS (or nix on macOS)
without having tried home manager.</p>
<p>I was hesitant to try Home Manager, since I didn’t wanna have “vendor lock-in”
and be unable to make use of my dotfiles elsewhere.</p>
<p>To be honest: whenever Nix pops up, I often see people say they don’t like the
Nix language, and that its error messages are hard to understand. My experience
with Nix before this was using it to describe Python packages, or Go
applications, or describe a declarative set of packages to use, and using
NixOS.<br />
– If people’s first experience with Nix is with home manager, I can see why
Nix might seem more trouble than it’s worth.</p>
<p>Here are my notes on the steps I took, following the <a href="https://nix-community.github.io/home-manager/">home manager
manual</a> and <a href="https://wiki.nixos.org/wiki/Home_Manager">the NixOS wiki page
on Home Manager</a>.</p>
<h1 id="a-taste-of-nixos-but-for-your-home-directory">A Taste of NixOS, but for Your Home Directory</h1>
<p>EDIT: Having tried this a bit.. one significant difference from the dotbot
approach: dotbot manages symlinks so that e.g. <code>~/.vimrc</code> links to the
repository where the dotbot was run from. The home-manager approach first
constructs a Nix package with the configuration files, then symlinks to these
files.</p>
<p>This demands a change in mindset, since this means the file which <code>~/.vimrc</code>
symlinks to is read-only.<br />
This makes more sense if describing the configuration files using Nix, compared
to the approach described below (which attempts to model dotbot).</p>
<p>I don’t mind “can’t edit the (generated) configuration files” when it comes to
OS files. I find it slightly more awkward with configuration files for Vim or
Emacs.</p>
<p>It’s often possible for configuration files to <code>include</code> other configuration
files. This is one way to “work around” the above restriction.</p>
<h1 id="installing-home-manager">Installing Home Manager</h1>
<p>I’d recently started using Nix flakes. Nix flakes are cool.</p>
<p>So, following the <a href="https://nix-community.github.io/home-manager/index.html#ch-nix-flakes">standalone setup with Nix
Flakes</a>
chapter of the manual..</p>
<p>The ‘trouble’ is, per discussion in
<a href="https://github.com/nix-community/home-manager/pull/2461">nix-community/home-manager#2461</a>,
Home Manager doesn’t support the new “nix command” style of profile management.<br />
i.e. Installing a package in nix classic would be <code>nix-env -iA nixpkgs.neovim</code>,
but with the new nix command style it’s <code>nix profile install nixpkgs#neovim</code>.<br />
And the old style of command is incompatible with the new style, so you can’t
use the old <code>nix-env</code> commands once you’ve used <code>nix profile</code>.</p>
<p>The PR provides people with forks which fix the issue. Worked for me.</p>
<p>Here’s <a href="https://github.com/rgoulter/dotfiles/commit/01238a1421b7cf48d92451bd63505b5c1c721e79">the
commit</a>
with the simple <code>home.nix</code> and <code>flake.nix</code> that I started with:</p>
<p><code>flake.nix</code> (which is pretty much boilerplate):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">description</span> <span class="op">=</span> <span class="st">&quot;rgoulter's Home Manager configuration&quot;</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">inputs</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">nixpkgs</span>.<span class="va">url</span> <span class="op">=</span> <span class="st">&quot;github:NixOS/nixpkgs/nixpkgs-unstable&quot;</span><span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">home-manager</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># https://github.com/nix-community/home-manager/pull/2461</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="va">inputs</span>.<span class="va">nixpkgs</span>.<span class="va">follows</span> <span class="op">=</span> <span class="st">&quot;nixpkgs&quot;</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Fork which allows using `nix profile` instead of `nix-env`</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># https://github.com/FlorianFranzen/home-manager/commit/4e97b01b2737bb0f39c18a65d87dd98659391b97</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># url = {</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="va">type</span>  <span class="op">=</span> <span class="st">&quot;github&quot;</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="va">owner</span> <span class="op">=</span> <span class="st">&quot;FlorianFranzen&quot;</span><span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="va">repo</span>  <span class="op">=</span> <span class="st">&quot;home-manager&quot;</span><span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      <span class="va">rev</span>   <span class="op">=</span> <span class="st">&quot;4e97b01b2737bb0f39c18a65d87dd98659391b97&quot;</span><span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="va">outputs</span> <span class="op">=</span> <span class="op">{</span> <span class="va">home-manager</span><span class="op">,</span> <span class="op">...</span> <span class="op">}</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      <span class="va">system</span> <span class="op">=</span> <span class="st">&quot;x86_64-linux&quot;</span><span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="va">username</span> <span class="op">=</span> <span class="st">&quot;rgoulter&quot;</span><span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">in</span> <span class="op">{</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="va">homeConfigurations</span>.<span class="st">&quot;</span><span class="sc">${</span>username<span class="sc">}</span>-<span class="sc">${</span>system<span class="sc">}</span><span class="st">&quot;</span> <span class="op">=</span> home<span class="op">-</span>manager.lib.homeManagerConfiguration <span class="op">{</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">inherit</span> system username<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">configuration</span> <span class="op">=</span> <span class="bu">import</span> <span class="ss">./home.nix</span><span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">homeDirectory</span> <span class="op">=</span> <span class="st">&quot;/home/</span><span class="sc">${</span>username<span class="sc">}</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the state version as needed.</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># See the changelog here:</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># https://nix-community.github.io/home-manager/release-notes.html</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">stateVersion</span> <span class="op">=</span> <span class="st">&quot;22.05&quot;</span><span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      <span class="op">};</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>(I went with <code>rgoulter-x86_64-linux</code> as the profile name since I’m not sure
how home manager configurations interact with flake outputs. Presumably
<code>rgoulter</code> would work just as well instead).</p>
<p>and the <code>home.nix</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">config</span><span class="op">,</span> <span class="va">pkgs</span><span class="op">,</span> <span class="op">...</span> <span class="op">}</span>:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">home</span>.<span class="va">stateVersion</span> <span class="op">=</span> <span class="st">&quot;22.05&quot;</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">programs</span>.<span class="va">home-manager</span>.<span class="va">enable</span> <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And following the commands given in the manual. Since I was running this from
a git repository on my machine:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nix</span> build <span class="at">--no-link</span> .#homeConfigurations.rgoulter-x86_64-linux.activationPackage</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="va">$(</span><span class="ex">nix</span> path-info .#homeConfigurations.rgoulter-x86_64-linux.activationPackage<span class="va">)</span><span class="st">&quot;</span><span class="ex">/activate</span></span></code></pre></div>
<h1 id="symlinking-to-existing-dotfiles">Symlinking to Existing Dotfiles</h1>
<p>Or “using home manager instead of dotbot”.</p>
<p>Dotbot takes an
<a href="https://github.com/rgoulter/dotfiles/blob/aa026733cf7c2bcdebc59a4a527257479549694f/install.conf.yaml">install.conf.yaml</a> to configure what files to link where.</p>
<p>Home Manager <em>can</em> use nix to write various config files. But it can also just
symlink given some source files.</p>
<p><a href="https://github.com/rgoulter/dotfiles/commit/aa026733cf7c2bcdebc59a4a527257479549694f">Commit</a>.</p>
<p>Updated <a href="https://github.com/rgoulter/dotfiles/blob/aa026733cf7c2bcdebc59a4a527257479549694f/home.nix"><code>home.nix</code></a>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">config</span><span class="op">,</span> <span class="va">pkgs</span><span class="op">,</span> <span class="op">...</span> <span class="op">}</span>:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">home</span>.<span class="va">stateVersion</span> <span class="op">=</span> <span class="st">&quot;22.05&quot;</span><span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">programs</span>.<span class="va">home-manager</span>.<span class="va">enable</span> <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># files in ~/.config/</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="va">xdg</span>.<span class="va">configFile</span>.<span class="st">&quot;alacritty/alacritty.yml&quot;</span>.<span class="va">source</span> <span class="op">=</span> <span class="ss">./alacritty.yml</span><span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">xdg</span>.<span class="va">configFile</span>.<span class="st">&quot;emacs-rgoulter/init.el&quot;</span>.<span class="va">source</span>  <span class="op">=</span> <span class="ss">./emacs.el</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># files in ~/</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">home</span>.<span class="va">file</span>.<span class="st">&quot;.emacs-profiles.el&quot;</span>.<span class="va">source</span> <span class="op">=</span> <span class="ss">./emacs-profiles.el</span><span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">home</span>.<span class="va">file</span>.<span class="st">&quot;.gvimrc&quot;</span>.<span class="va">source</span> <span class="op">=</span> <span class="ss">./gvimrc</span><span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using the submodule in this dotfiles repo would make</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># require a more awkward flake URI.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="va">home</span>.<span class="va">file</span>.<span class="st">&quot;.nvim/bundle/Vundle.vim&quot;</span>.<span class="va">source</span> <span class="op">=</span> pkgs.fetchFromGitHub <span class="op">{</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="va">owner</span> <span class="op">=</span> <span class="st">&quot;VundleVim&quot;</span><span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="va">repo</span> <span class="op">=</span> <span class="st">&quot;Vundle.vim&quot;</span><span class="op">;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="va">rev</span> <span class="op">=</span> <span class="st">&quot;cfd3b2d388a8c2e9903d7a9d80a65539aabfe933&quot;</span><span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="va">sha256</span> <span class="op">=</span> <span class="st">&quot;sha256-OCCXgMVWj/aBWLGaZmMr+cD546+QgynmEN/ECp1r08Q=&quot;</span><span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <code>xdg.configFile.&lt;name&gt;.source</code> (and <code>home.file.&lt;name&gt;.source</code>) are given as
examples on the <a href="https://wiki.nixos.org/wiki/Home_Manager#Managing_your_dotfiles">Home Manager page in the NixOS
wiki</a>, and
documented in <a href="https://nix-community.github.io/home-manager/options.html">Appendix A of the Home Manager
manual</a>.</p>
<p>I can then apply the <code>home.nix</code> with, as the <a href="https://nix-community.github.io/home-manager/options.html">Home Manager
manual</a> explains:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">home-manager</span> switch <span class="at">--flake</span> <span class="st">'.#rgoulter-x86_64-linux'</span></span></code></pre></div>
<h1 id="first-steps-in-refactoring">First Steps in Refactoring</h1>
<p>As can be seen in the above commit, it’s … not pretty.</p>
<p>Look. Complain about or be aware of <a href="https://mikehadlow.blogspot.com/2012/05/configuration-complexity-clock.html">the Configuration Complexity
Clock</a>.
But we’re at DSL o’clock here:</p>
<p>First step is to extract the attribute set out to <code>let ... in</code> bindings.</p>
<p><a href="https://github.com/rgoulter/dotfiles/commit/0663950cc3e564c35a0df9bf65c06fd66b8a83e6">Commit</a></p>
<p>Updated <a href="https://github.com/rgoulter/dotfiles/blob/0663950cc3e564c35a0df9bf65c06fd66b8a83e6/home.nix"><code>home.nix</code></a>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">config</span><span class="op">,</span> <span class="va">pkgs</span><span class="op">,</span> <span class="op">...</span> <span class="op">}</span>:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Attribute set for dotfiles in this repo to link into ~/.config.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute name is for ~/.config/$attrSetName,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  e.g. &quot;alacritty/alacritty.yml&quot; for ~/.config/alacritty/alacritty.yml</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute value is the path to the dotfile in this repo.</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">configFilesToLink</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span>alacritty/alacritty.yml<span class="st">&quot;</span> <span class="op">=</span> <span class="ss">./alacritty.yml</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;emacs-rgoulter/init.el&quot;</span>  <span class="op">=</span> <span class="ss">./emacs.el</span><span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;emacs-rgoulter/straight/versions/default.el&quot;</span>  <span class="op">=</span> <span class="ss">./emacs.d/straight/versions/default.el</span><span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># etc.</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Attribute set for dotfiles in this repo to link into home directory.</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute name is for ~/$attrSetName,</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  e.g. &quot;.hgrc&quot; for ~/.hgrc.</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute value is the path to the dotfile in this repo.</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="va">homeFilesToLink</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span>.emacs-profiles.el<span class="st">&quot;</span> <span class="op">=</span> <span class="ss">./emacs-profiles.el</span><span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;.gvimrc&quot;</span> <span class="op">=</span> <span class="ss">./gvimrc</span><span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># etc.</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to help map attrs for symlinking home.file, xdg.configFile</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. from { &quot;.hgrc&quot; = ./hgrc; } to { &quot;.hgrc&quot;.source = ./hgrc; }</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="va">toSource</span> <span class="op">=</span> <span class="va">configDirName</span><span class="op">:</span> <span class="va">dotfilesPath</span><span class="op">:</span> <span class="op">{</span> <span class="va">source</span> <span class="op">=</span> dotfilesPath<span class="op">;</span> <span class="op">};</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Symlink files under ~, e.g. ~/.hgrc</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="va">home</span>.<span class="va">file</span> <span class="op">=</span> pkgs.lib.attrsets.mapAttrs toSource homeFilesToLink<span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Symlink files under ~/.config, e.g. ~/.config/alacritty/alacritty.yml</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="va">xdg</span>.<span class="va">configFile</span> <span class="op">=</span> pkgs.lib.attrsets.mapAttrs toSource configFilesToLink<span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ...</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>I figured out to use <code>lib.attrsets.mapAttrs</code> by looking at this <a href="https://teu5us.github.io/nix-lib.html">helpful
community-provided documentation page</a>.
But otherwise, the Nix manual has a chapter on <a href="https://nixos.org/manual/nix/stable/expressions/builtins.html">its builtin
functions</a>, and
the <a href="https://nixos.org/manual/nixpkgs/stable/#chap-functions">Nixpkgs manual has a chapter on its library
functions</a>.</p>
<p>To help read the above code, the example given for <code>mapAttrs</code> is:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lib.attrsets.mapAttrs</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="va">name</span><span class="op">:</span> <span class="va">value</span><span class="op">:</span> name <span class="op">+</span> <span class="st">&quot;-&quot;</span> <span class="op">+</span> value<span class="op">)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span> <span class="va">x</span> <span class="op">=</span> <span class="st">&quot;foo&quot;</span><span class="op">;</span> <span class="va">y</span> <span class="op">=</span> <span class="st">&quot;bar&quot;</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; { x = &quot;x-foo&quot;; y = &quot;y-bar&quot;; }</span></span></code></pre></div>
<p>I think this level of functional programming is relatively accessible.</p>
<h1 id="refactoring-a-bit-further">Refactoring a bit Further</h1>
<p>I mean, the above is okay, but it’s just nagging seeing code like <code>.gvimrc" = ./gvimrc;</code>.</p>
<p>People have different tastes as how how implicit vs explicit they’d prefer things.
It’s hardly a burden to be explicit if you’re unfamiliar with the domain.</p>
<p>But I had to try. <a href="https://github.com/rgoulter/dotfiles/commit/6375425ed54d63b807a43c77acdee5acf4680a23">Commit</a>.</p>
<p>Updated <a href="https://github.com/rgoulter/dotfiles/blob/6375425ed54d63b807a43c77acdee5acf4680a23/home.nix"><code>home.nix</code></a>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">config</span><span class="op">,</span> <span class="va">pkgs</span><span class="op">,</span> <span class="op">...</span> <span class="op">}</span>:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. given &quot;alacritty/alacritty.yml&quot;,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the attrset { &quot;alacritty/alacritty.yml&quot; = ./alacritty/alacritty.yml; }.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">genAttrsForSimpleLink</span> <span class="op">=</span> <span class="va">fileName</span><span class="op">:</span> <span class="ss">./.</span> <span class="op">+</span> <span class="op">(</span><span class="st">&quot;/&quot;</span> <span class="op">+</span> fileName<span class="op">);</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. given &quot;hgrc&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the attrset { &quot;.hgrc&quot; = ./hgrc; }.</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">genAttrsForSimpleDotLink</span> <span class="op">=</span> <span class="va">fileName</span><span class="op">:</span> <span class="op">{</span> <span class="st">&quot;</span>.<span class="sc">${</span>fileName<span class="sc">}</span><span class="st">&quot;</span> <span class="op">=</span> <span class="ss">./.</span> <span class="op">+</span> <span class="op">(</span><span class="st">&quot;/&quot;</span> <span class="op">+</span> fileName<span class="op">);</span> <span class="op">};</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ...</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List of dotfiles where the path to link under</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ~/.config/ matches the path in the dotfiles repo.</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. ~/.config/alacritty/alacritty.yml matches ./alacritty/alacritty.yml.</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">simpleConfigFilesToLinkList</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fish/config.fish&quot;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;kitty/kitty.conf&quot;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;starship.toml&quot;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># etc.</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">];</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Files where the symlinks aren't following a nice convention.</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="va">unconventionalConfigFilesToLink</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span>emacs-rgoulter/init.el<span class="st">&quot;</span>  <span class="op">=</span> <span class="ss">./emacs.el</span><span class="op">;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;nvim/init.vim&quot;</span> <span class="op">=</span> <span class="ss">./vimrc</span><span class="op">;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># etc.</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. &quot;gvimrc&quot; to link &quot;~/.gvimrc&quot; to ./gvimrc</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="va">simpleHomeFilesToLinkList</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;gvimrc&quot;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hgrc&quot;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;tmux.conf&quot;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;vimrc&quot;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># etc.</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="op">];</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="va">unconventionalHomeFilesToLink</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span>.nvim/after/ftplugin/org.vim<span class="st">&quot;</span> <span class="op">=</span> <span class="ss">./vim/after/ftplugin/org.vim</span><span class="op">;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;.nvim/bundle/Vundle.vim&quot;</span> <span class="op">=</span> vundleRepoSrc<span class="op">;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;.vim/bundle/Vundle.vim&quot;</span> <span class="op">=</span> vundleRepoSrc<span class="op">;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Attribute set for dotfiles in this repo to link into ~/.config.</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute name is for ~/.config/$attrSetName,</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  e.g. &quot;alacritty/alacritty.yml&quot; for ~/.config/alacritty/alacritty.yml</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute value is the path to the dotfile in this repo.</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="va">configFilesToLink</span> <span class="op">=</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>pkgs.lib.attrsets.genAttrs simpleConfigFilesToLinkList genAttrsForSimpleLink<span class="op">)</span> <span class="op">//</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    unconventionalConfigFilesToLink<span class="op">;</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Attribute set for dotfiles in this repo to link into home directory.</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute name is for ~/$attrSetName,</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  e.g. &quot;.hgrc&quot; for ~/.hgrc.</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The attribute value is the path to the dotfile in this repo.</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="va">homeFilesToLink</span> <span class="op">=</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>pkgs.lib.lists.foldr <span class="op">(</span><span class="va">a</span><span class="op">:</span> <span class="va">b</span><span class="op">:</span> a <span class="op">//</span> b<span class="op">)</span> <span class="op">{}</span> <span class="op">(</span><span class="bu">map</span> genAttrsForSimpleDotLink simpleHomeFilesToLinkList<span class="op">))</span> <span class="op">//</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    unconventionalHomeFilesToLink<span class="op">;</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Symlink files under ~, e.g. ~/.hgrc</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="va">home</span>.<span class="va">file</span> <span class="op">=</span> pkgs.lib.attrsets.mapAttrs toSource homeFilesToLink<span class="op">;</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Symlink files under ~/.config, e.g. ~/.config/alacritty/alacritty.yml</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  <span class="va">xdg</span>.<span class="va">configFile</span> <span class="op">=</span> pkgs.lib.attrsets.mapAttrs toSource configFilesToLink<span class="op">;</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ...</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This one takes a bit more explaining.</p>
<p>In order to get from <code>[ "fish/config.fish" ]</code> to <code>{ "fish/config.fish" = ./fish/config.fish; }</code>,
<code>genAttrs</code> can be used.</p>
<pre><code>lib.attrsets.genAttrs [ &quot;foo&quot; &quot;bar&quot; ] (name: &quot;x_${name}&quot;)
=&gt; { foo = &quot;x_foo&quot;; bar = &quot;x_bar&quot;; }</code></pre>
<p>Hence, we can factor out the files which follow a nice convention to just a list,
and construct <code>configFilesToLink</code> with:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g. given &quot;alacritty/alacritty.yml&quot;,</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># return the attrset { &quot;alacritty/alacritty.yml&quot; = ./alacritty/alacritty.yml; }.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>genAttrsForSimpleLink = <span class="va">fileName</span><span class="op">:</span> <span class="ss">./.</span> <span class="op">+</span> <span class="op">(</span><span class="st">&quot;/&quot;</span> <span class="op">+</span> fileName<span class="op">)</span>;</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>configFilesToLink =</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>pkgs.lib.attrsets.genAttrs simpleConfigFilesToLinkList genAttrsForSimpleLink<span class="op">)</span> <span class="op">//</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  unconventionalConfigFilesToLink;</span></code></pre></div>
<p>Unfortunately, to get <code>[ "vimrc" ]</code> into <code>{ ".vimrc" = ./vimrc }</code>, this involves
transforming “vimrc” to “.vimrc”, it’s a bit more involved:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode nix"><code class="sourceCode nix"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g. given &quot;hgrc&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># return the attrset { &quot;.hgrc&quot; = ./hgrc; }.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>genAttrsForSimpleDotLink = <span class="va">fileName</span><span class="op">:</span> <span class="op">{</span> <span class="st">&quot;</span>.<span class="sc">${</span>fileName<span class="sc">}</span><span class="st">&quot;</span> <span class="op">=</span> <span class="ss">./.</span> <span class="op">+</span> <span class="op">(</span><span class="st">&quot;/&quot;</span> <span class="op">+</span> fileName<span class="op">);</span> <span class="op">}</span>;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>homeFilesToLink =</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>pkgs.lib.lists.foldr <span class="op">(</span><span class="va">a</span><span class="op">:</span> <span class="va">b</span><span class="op">:</span> a <span class="op">//</span> b<span class="op">)</span> <span class="op">{}</span> <span class="op">(</span><span class="bu">map</span> genAttrsForSimpleDotLink simpleHomeFilesToLinkList<span class="op">))</span> <span class="op">//</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  unconventionalHomeFilesToLink;</span></code></pre></div>
<p>(where <code>pkgs.lib.lists.foldr (a: b: a // b) {}</code> is essentially <code>listToAttrs</code>,
but my version of Nix didn’t have this. In nix, <code>{ a = 3; } // { b = 4; }</code>
evaluates to <code>{ a = 3; b = 4; }</code>).</p>

<hr />

<div>
    
    <a href="../../../blog/posts/programming/2022-03-21-project-specific-tooling-in-emacs-with-nix-flakes-and-direnv.html" style="float:left;">Newer post</a>
    
    
    <a href="../../../blog/posts/argument/2022-01-11-deborah-tannens-you-just-dont-understand-is-wonderful.html" style="float:right; text-align: right;">Older post</a>
    
</div>
<br style="clear: both;" />

<hr />

            </div>

            <hr style="margin-bottom: 0px; border-top: 2px solid black;" />

            <div id="footer" class="pull-right" style="padding-right: 10px;">
                Site proudly generated by
                <a href="http://jaspervdj.be/hakyll">Hakyll</a>
            </div>
        </div>

        <script>
            // The callbacks we wanna use
            // Phone-home, telling Google Analytics various metrics/dimensions

            // Use custom dimensions & metrics
            var AnalyticDimensionReaderKind = 'dimension1';
            var AnalyticMetricActiveTime      = 'metric1';
            var AnalyticMetricLongestIdleTime = 'metric2';
            var AnalyticMetricReadCount       = 'metric3';

            var gaCallbacks = {
                "scrollPercent": function(ms, perc) {
                    if (perc > 85) {
                        // EVENT: Page read
                        ga('send', {
                            hitType:       'event',
                            eventCategory: 'Scrolling',
                            eventAction:   'atBottom',
                            eventValue:    String(ms)
                        });
                    }
                },
                "read": function(ms, ct, timeToReach) {
                    // Use this to set DIMENSION
                    // timeToReach < 5s ==> Skim (default = Visitor)
                    if (timeToReach < 5 * 1000) {
                        // dimension1 = ReaderKind
                        ga('set', AnalyticDimensionReaderKind, "skimmer");
                    }

                    // timeToReach > 30s ==> Reader
                    if (timeToReach > 30 * 1000) {
                        // dimension1 = ReaderKind
                        ga('set', AnalyticDimensionReaderKind, "reader");
                    }

                    // EVENT: Page read
                    ga('send', {
                        hitType:       'event',
                        eventCategory: 'Reading',
                        eventAction:   'read',
                        eventValue:    String(timeToReach)
                    });

                    // METRIC
                    ga('set', AnalyticMetricReadCount, String(ct));
                },
                "initialIdle": function(ms) {
                    // EVENT: Started Reading
                    ga('send', {
                        hitType:       'event',
                        eventCategory: 'Scrolling',
                        eventAction:   'begun',
                        eventValue:    String(ms)
                    });
                },
                "timeSpent": function(total, active, curIdle, initIdle, longestIdle) {
                    // Update METRIC(S)?
                    ga('set', AnalyticMetricActiveTime, String(active));
                    ga('set', AnalyticMetricLongestIdleTime, String(longestIdle));
                },
                "idle": function(ms) {
                },
                "longestIdle": function(ms) {
                }
            }

            window.onload = function() {
                myAnalyticsInit(gaCallbacks);

                //
                // Initial dimensions & metrics
                //

                ga('set', AnalyticMetricReadCount, String(0));

                // EVENT: Page load
                ga('send', {
                    hitType:       'event',
                    eventCategory: 'pageLoad',
                    eventAction:   'begun',
                    eventValue:    String(0)
                });

                // DIMENSION: visitor
                ga('set', AnalyticDimensionReaderKind, "visitor");
            }
        </script>
    </body>
</html>
